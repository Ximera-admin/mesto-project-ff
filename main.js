(()=>{"use strict";var e=function(e){var t=e.target.closest(".popup")||document.querySelector(".popup_is-opened");t&&(t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",r))},t=function(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",r)},r=function(t){"Escape"===t.key&&e(t)},n=function(t){t.target.closest(".popup__content")||e(t)},o=function(e,t,r,n){var o,a,c=t.cloneNode(!0),i=c.querySelector(".card__image"),l=c.querySelector(".card__title"),s=c.querySelector(".card__delete-button"),u=c.querySelector(".card__like-button"),d=c.querySelector(".card__like-count");return l.textContent=e.name,i.src=e.link,i.alt="Фотография места: ".concat(e.name),d&&(d.textContent=(null===(a=e.likes)||void 0===a?void 0:a.length)||0),null!==(o=e.likes)&&void 0!==o&&o.some((function(e){return e._id===n}))&&u.classList.add("card__like-button_is-active"),e.owner&&e.owner._id!==n&&(s.style.display="none"),s.addEventListener("click",r.onDelete),u.addEventListener("click",r.onLike),i.addEventListener("click",r.onImageClick),c},a=function(e,t,r){var n=e.querySelector("#".concat(t.id,"-error"))||e.querySelector("#".concat(t.name,"-error"));n&&(n.textContent="",n.classList.remove(r.visibleErrorClass),t.classList.remove(r.errorInputClass))},c=function(e,t,r){return t.validity.valid?(a(e,t,r),!0):(function(e,t,r,n){var o=e.querySelector("#".concat(t.id,"-error"))||e.querySelector("#".concat(t.name,"-error"));o&&(o.textContent=r,o.classList.add(n.visibleErrorClass),t.classList.add(n.errorInputClass))}(e,t,t.validity.valueMissing&&t.dataset.errorRequired?t.dataset.errorRequired:t.validity.patternMismatch&&t.dataset.errorPattern?t.dataset.errorPattern:t.validationMessage,r),!1)},i=function(e,t){e.disabled=!0,e.classList.add(t.disabledBtnClass)},l=function(e,t,r){e.every((function(e){return c(t.closest("form"),e,r)}))?function(e,t){e.disabled=!1,e.classList.remove(t.disabledBtnClass)}(t,r):i(t,r)},s=function(e,t){var r=Array.from(e.querySelectorAll(t.inputClass)),n=e.querySelector(t.submitBtnClass);r.forEach((function(r){return a(e,r,t)})),i(n,t)},u={baseEndpoint:"https://mesto.nomoreparties.co/v1/wff-cohort-39",headers:{authorization:"3193d9f6-f26f-4e13-8fe0-26211ac7b423","Content-Type":"application/json"}},d=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},p=function(e){return fetch("".concat(u.baseEndpoint,"/cards/likes/").concat(e),{method:"PUT",headers:u.headers}).then(d)},f=function(e){return fetch("".concat(u.baseEndpoint,"/cards/likes/").concat(e),{method:"DELETE",headers:u.headers}).then(d)};function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var v,y=null,_={cardsContainer:document.querySelector(".places__list"),cardTemplate:document.querySelector("#card-template").content,modalCloseButtons:document.querySelectorAll(".popup__close"),allModals:document.querySelectorAll(".popup"),editProfileBtn:document.querySelector(".profile__edit-button"),addCardBtn:document.querySelector(".profile__add-button"),profileImage:document.querySelector(".profile__image"),profileTitle:document.querySelector(".profile__title"),profileDescription:document.querySelector(".profile__description"),profileForm:document.forms["edit-profile"],newCardForm:document.forms["new-place"],avatarForm:document.forms["avatar-form"],imageModal:document.querySelector(".popup_type_image"),editModal:document.querySelector(".popup_type_edit"),newCardModal:document.querySelector(".popup_type_new-card"),avatarModal:document.querySelector(".popup_type_avatar")},h={formClass:".popup__form",inputClass:".popup__input",submitBtnClass:".popup__button",disabledBtnClass:"popup__button_inactive",errorInputClass:"popup__input_type_error",visibleErrorClass:"popup__error_visible"},C=function(e){var r=e.target.closest(".card"),n=r.querySelector(".card__image");_.imageModal.querySelector(".popup__image").src=n.src,_.imageModal.querySelector(".popup__image").alt=n.alt,_.imageModal.querySelector(".popup__caption").textContent=r.querySelector(".card__title").textContent,t(_.imageModal)},b=function(e,t){var r;confirm("Удалить карточку?")&&(r=t._id,fetch("".concat(u.baseEndpoint,"/cards/").concat(r),{method:"DELETE",headers:u.headers}).then(d)).then((function(){e.target.closest(".card").remove()})).catch(console.error)},S=function(e,t){var r=e.target,n=r.closest(".card").querySelector(".card__like-count");(r.classList.contains("card__like-button_is-active")?f:p)(t._id).then((function(e){r.classList.toggle("card__like-button_is-active"),n&&(n.textContent=e.likes.length)})).catch(console.error)};v=h,Array.from(document.querySelectorAll(v.formClass)).forEach((function(e){return function(e,t){var r=Array.from(e.querySelectorAll(t.inputClass)),n=e.querySelector(t.submitBtnClass);r.forEach((function(o){o.addEventListener("input",(function(){c(e,o,t),l(r,n,t)}))})),l(r,n,t)}(e,v)})),_.modalCloseButtons.forEach((function(t){t.addEventListener("click",e)})),_.allModals.forEach((function(e){e.addEventListener("click",n)})),_.editProfileBtn.addEventListener("click",(function(){_.profileForm.elements.name.value=_.profileTitle.textContent,_.profileForm.elements.description.value=_.profileDescription.textContent,t(_.editModal),s(_.profileForm,h)})),_.addCardBtn.addEventListener("click",(function(){t(_.newCardModal),_.newCardForm.reset(),s(_.newCardForm,h)})),_.profileImage.addEventListener("click",(function(){t(_.avatarModal),_.avatarForm.reset(),s(_.avatarForm,h)})),_.profileForm.addEventListener("submit",(function(t){t.preventDefault();var r,n,o=_.profileForm.querySelector(h.submitBtnClass),a=o.textContent;o.textContent="Сохранение...",(r=_.profileForm.elements.name.value,n=_.profileForm.elements.description.value,fetch("".concat(u.baseEndpoint,"/users/me"),{method:"PATCH",headers:u.headers,body:JSON.stringify({name:r,about:n})}).then(d)).then((function(r){_.profileTitle.textContent=r.name,_.profileDescription.textContent=r.about,e(t)})).catch(console.error).finally((function(){o.textContent=a}))})),_.newCardForm.addEventListener("submit",(function(t){t.preventDefault();var r,n,a=_.newCardForm.querySelector(h.submitBtnClass),c=a.textContent;a.textContent="Сохранение...",(r=_.newCardForm.elements["place-name"].value,n=_.newCardForm.elements.link.value,fetch("".concat(u.baseEndpoint,"/cards"),{method:"POST",headers:u.headers,body:JSON.stringify({name:r,link:n})}).then(d)).then((function(r){var n=o(r,_.cardTemplate,{onDelete:function(e){return b(e,r)},onLike:function(e){return S(e,r)},onImageClick:C},y);_.cardsContainer.prepend(n),e(t),_.newCardForm.reset()})).catch(console.error).finally((function(){a.textContent=c}))})),_.avatarForm.addEventListener("submit",(function(t){t.preventDefault();var r,n=_.avatarForm.querySelector(h.submitBtnClass),o=n.textContent;n.textContent="Сохранение...",(r=_.avatarForm.elements.avatar.value,fetch("".concat(u.baseEndpoint,"/users/me/avatar"),{method:"PATCH",headers:u.headers,body:JSON.stringify({avatar:r})}).then(d)).then((function(r){_.profileImage.style.backgroundImage="url(".concat(r.avatar,")"),e(t)})).catch(console.error).finally((function(){n.textContent=o}))})),Promise.all([fetch("".concat(u.baseEndpoint,"/users/me"),{headers:u.headers}).then(d),fetch("".concat(u.baseEndpoint,"/cards"),{headers:u.headers}).then(d)]).then((function(e){var t,r,n=(r=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,c,i=[],l=!0,s=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=a.call(r)).done)&&(i.push(n.value),i.length!==t);l=!0);}catch(e){s=!0,o=e}finally{try{if(!l&&null!=r.return&&(c=r.return(),Object(c)!==c))return}finally{if(s)throw o}}return i}}(t,r)||function(e,t){if(e){if("string"==typeof e)return m(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?m(e,t):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=n[0],c=n[1];y=a._id,_.profileTitle.textContent=a.name,_.profileDescription.textContent=a.about,_.profileImage.style.backgroundImage="url(".concat(a.avatar,")"),function(e){_.cardsContainer.innerHTML="",e.forEach((function(e){var t=o(e,_.cardTemplate,{onDelete:function(t){return b(t,e)},onLike:function(t){return S(t,e)},onImageClick:C},y);_.cardsContainer.append(t)}))}(c)})).catch(console.error)})();